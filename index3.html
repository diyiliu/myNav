<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>导航</title>
    <link rel="stylesheet" href="plugin/materialize/css/materialize.css">
    <link rel="stylesheet" href="plugin/materialize/css/materialize-icon.css">
    <link rel="stylesheet" href="plugin/gridly/css/gridly.css">
    <link rel="stylesheet" href="css/nav3.css">
    <script src="js/jquery-3.2.1.js"></script>
    <script src="plugin/materialize/js/materialize.js"></script>
    <script src="plugin/gridly/js/gridly.js"></script>
</head>
<body>
<div class="section search" style="box-sizing: border-box">
    <div class="container">
        <div class="row">
            <div class="input-field col m6 offset-m2">
                <input type="text" class="white">
            </div>
            <div class="input-field col m2">
                <input type="submit" class="btn" value="百度一下">
            </div>
        </div>
    </div>
</div>
<div class="section main" id="main">
    <div class="container">
        <form id="sortForm" action="/test" method="post"></form>
        <div class="row toolbar">
            <div class="right">
                <a href="#modal1" class="modal-trigger" title="添加" id="add"><i
                        class="material-icons">playlist_add</i></a>
                <a href="#" title="排序" id="sort"><i class="material-icons">sort</i></a>
                <a href="#" title="保存" id="clear"><i class="material-icons">clear_all</i></a>
            </div>
        </div>
        <ul>
            <li>
                <div class="row">
                    <div class="col m2 center">
                        <h5>综合</h5>
                    </div>
                    <ul class="col m10 gridly nav-list">
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索1</a>
                            <a href="#" class="del" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索2</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索3</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索4</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索5</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索6</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索7</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索8</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                    </ul>
                </div>
            </li>
            <li>
                <div class="row">
                    <div class="col m2 center">
                        <h5>综合</h5>
                    </div>
                    <ul class="col m10 gridly nav-list">
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索1</a>
                            <a href="#" class="del" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索2</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索3</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索4</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索5</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索6</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索7</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索8</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
    </div>
</div>
<!-- Modal Structure -->
<div id="modal1" class="modal siteModal">
    <div class="modal-content">
        <h5>添加网址</h5>
        <div class="row">
            <div class="input-field col m2">
                <input type="text">
            </div>
            <div class="input-field col m6">
                <input type="text">
            </div>
            <div class="input-field col m4 type">
                <select id="selType">
                    <option value="" disabled selected>选择类别</option>
                    <option value="1">综合</option>
                    <option value="2">新闻</option>
                    <option value="3">娱乐</option>
                </select>
                <a href="#modal2" class="modal-trigger"><i class="material-icons">more_vert</i></a>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-action modal-clear waves-effect btn deep-orange">保存</a>
    </div>
</div>

<div id="modal2" class="modal siteModal">
    <div class="modal-content">
        <div class="row">
            <div class="input-field col m2">
                <label for="type_name">新增类别</label>
            </div>
            <div class="input-field col m10">
                <input id="type_name" type="text">
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" onclick="addType()" class="modal-action waves-effect btn deep-orange">保存</a>
    </div>
</div>


<script>
    $(document).ready(function () {
        $('select').material_select();
        $('.modal').modal();

        $('#main .nav-list .brick .del').click(function () {
            $(this).parent('li').remove();
        });

        $('#sort').click(function () {
            $(this).hide();
            $('#clear').show();
            $('.gridly').gridly({
                base: 50, // px
                gutter: 20, // px
                columns: 10,
                callbacks: {reordering: reordering, reordered: reordered}
            });
            $('.main .nav-list').addClass('bricks');
            $('.gridly').gridly('draggable', 'on');
        });

        $('#clear').click(function () {
            $(this).hide();
            $('#sort').show();

            //saveSort();

            $('#main  .nav-list').removeClass('bricks');
            $('#main  .nav-list').removeAttr('style');
            $('#main  .nav-list li').removeAttr('style');
            $('.gridly').gridly('draggable', 'off');
        });

        var reordering = function ($elements) {
            // Called before the drag and drop starts with the elements in their starting position.
        };
        var reordered = function (e) {
            // Called after the drag and drop ends with the elements in their ending position.
        };
    });

    function addType() {
        var name = $("#type_name").val();
        $("#selType").append("<option value='" + name + "'>" + name + "</option>");
        $('#modal2').modal('clear');
        $('select').material_select();
    }

    function saveSort() {
        var param = {};
        $('.main .container>ul>li').each(function () {
            var typeName = $(this).find('h5').html();

            var tmp = {};
            $(this).find('ul>li').each(function () {
                var oA = $(this).find('a');

                var ct = {};
                ct.href = $(oA).attr('href');
                ct.name = $(oA).html();

                var self = $(this);
                var left = self.css('left').replace(/px/, '');
                var top = self.css('top').replace(/px/, '');

                //权重 = left + top * col_base
                var weight = parseInt(left) + parseInt(top) * 10000;
                tmp[weight] = ct;
            });
            var arr = [];
            for (var i in tmp) {
                var val = tmp[i];
                arr.push(val);
            }
            console.log(typeName);
            console.log(JSON.stringify(arr));
        });
    }

    function post() {
        var oSf = $("#sortForm")
        oSf.append('<input type="text" name="test" value="123" >');
        oSf.submit();
    }
</script>
</body>
</html>