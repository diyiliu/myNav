<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>导航</title>
    <link rel="stylesheet" href="plugin/materialize/css/materialize.css">
    <link rel="stylesheet" href="plugin/materialize/css/materialize-icon.css">
    <link rel="stylesheet" href="plugin/gridly/css/gridly.css">
    <link rel="stylesheet" href="css/nav3.css">
    <script src="js/jquery-3.2.1.js"></script>
    <script src="plugin/materialize/js/materialize.js"></script>
    <script src="plugin/gridly/js/gridly.js"></script>
</head>
<body>
<div class="section search" style="box-sizing: border-box">
    <div class="container">
        <div class="row">
            <div class="input-field col m6 offset-m2">
                <input type="text" class="white">
            </div>
            <div class="input-field col m2">
                <input type="submit" class="btn" value="百度一下">
            </div>
        </div>
    </div>
</div>
<div class="section main" id="main">
    <div class="container">
        <form id="sortForm" action="/test" method="post"></form>
        <div class="row toolbar">
            <div class="right">
                <a href="#modal1" class="modal-trigger" title="添加" id="add"><i
                        class="material-icons">playlist_add</i></a>
                <a href="#" title="排序" id="sort"><i class="material-icons">sort</i></a>
                <a href="#" title="保存" id="clear"><i class="material-icons">clear_all</i></a>
            </div>
        </div>
        <ul>
            <li>
                <div class="row">
                    <div class="col m2 center">
                        <h5>综合</h5>
                    </div>
                    <ul class="col m10 gridly nav-list">
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索1</a>
                            <a href="#" class="del" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索2</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索3</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索4</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索5</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索6</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索7</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索8</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                    </ul>
                </div>
            </li>
            <li>
                <div class="row">
                    <div class="col m2 center">
                        <h5>综合</h5>
                    </div>
                    <ul class="col m10 gridly nav-list">
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索1</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索2</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索3</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索4</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索5</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索6</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索7</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                        <li class="brick">
                            <a href="#" class="site"><img src="img/bd.ico">百度搜索8</a>
                            <a href="#" class="del"><i class="material-icons tiny">clear</i></a>
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
    </div>
</div>
<!-- Modal Structure -->
<div id="modal1" class="modal siteModal">
    <div class="modal-content">
        <h5>添加网址</h5>
        <div class="row">
            <div class="input-field col m2">
                <input type="text">
            </div>
            <div class="input-field col m6">
                <input type="text">
            </div>
            <div class="input-field col m4 type">
                <select id="selType">
                    <option value="" disabled selected>选择类别</option>
                    <option value="1">综合</option>
                    <option value="2">新闻</option>
                    <option value="3">娱乐</option>
                </select>
                <a href="#modal2" class="modal-trigger" id="modal2Show"><i class="material-icons">more_vert</i></a>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-action modal-clear waves-effect btn deep-orange">保存</a>
    </div>
</div>

<div id="modal2" class="modal typeModal">
    <div class="modal-content">
        <div class="row">
            <div class="input-field col m2">
                <label for="type_name">新增类别</label>
            </div>
            <div class="input-field col m10">
                <input id="type_name" type="text">
            </div>
        </div>
        <div class="row">
            <ul class="col m12 typeGroup gridly">
                <li class="brick">综合<a href="#" class="del"><i class="material-icons tiny">clear</i></a></li>
                <li class="brick">新闻<a href="#" class="del"><i class="material-icons tiny">clear</i></a></li>
                <li class="brick">娱乐<a href="#" class="del"><i class="material-icons tiny">clear</i></a></li>
                <li class="brick">综合<a href="#" class="del"><i class="material-icons tiny">clear</i></a></li>
                <li class="brick">新闻<a href="#" class="del"><i class="material-icons tiny">clear</i></a></li>
                <li class="brick">娱乐<a href="#" class="del"><i class="material-icons tiny">clear</i></a></li>
            </ul>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" onclick="insertType()" class="modal-action waves-effect btn">插入</a>
        <a href="#!" onclick="addType()" class="modal-action waves-effect btn deep-orange">保存</a>
    </div>
</div>


<script>
    $(document).ready(function () {
        $('select').material_select();
        $('.modal').modal();

        $('#main .nav-list .brick .del').click(function () {
            var group = $(this).closest('.nav-list');
            var len = $(group).find('li').length;
            if (len == 1) {
                var t = $(group).closest('.row').parent('li');
                $(t).remove();
            } else {
                $(this).parent('li').remove();
            }
        });

        $('#sort').click(function () {
            $(this).hide();
            $('#clear').show();
            $('.main .nav-list').addClass('bricks');
            $('.nav-list').gridly({
                base: 50, // px
                gutter: 20, // px
                columns: 10
            });
            $('.nav-list').gridly('draggable', 'on');
        });

        $('#modal2Show').click(function () {
            $('.typeGroup').gridly({
                base: 40, // px
                gutter: 45, // px
                columns: 8
            });
        });

        $('#modal2 .typeGroup .del').click(function () {
            $(this).closest('li').remove();
        });

        $('#clear').click(function () {
            $(this).hide();
            $('#sort').show();

            saveSort();

            $('#main  .nav-list').removeClass('bricks');
            $('#main  .nav-list').removeAttr('style');
            $('#main  .nav-list li').removeAttr('style');
            $('.nav-list').gridly('draggable', 'off');
        });
    });

    function insertType() {
        var name = $("#type_name").val();
        if (name.trim().length > 0){
            $('#modal2 .typeGroup').append(' <li class="brick">'+name+'<a href="#" class="del"><i class="material-icons tiny">clear</i></a></li>');
            $('#modal2 .typeGroup').gridly({
                base: 40, // px
                gutter: 45, // px
                columns: 8
            });
            $("#type_name").val('');
        }
    }

    function addType() {
        $("#selType").empty();
        var tmp = [];
        $('#modal2 .typeGroup li').each(function () {
            var name = $(this).html().replace(/<a.*a>/, '');
            var self = $(this);
            var left = self.css('left').replace(/px/, '');
            var top = self.css('top').replace(/px/, '');

            //权重 = left + top * col_base
            var weight = parseInt(left) + parseInt(top) * 10000;
            tmp[weight] = name;
        });

        for (var i in tmp){
            var t = tmp[i];
            $("#selType").append('<option value="' + t + '">' + t + '</option>')
        }
        $('#modal2').modal('close');
        $('select').material_select();
    }

    function saveSort() {
        var param = [];
        $('.main .container>ul>li').each(function () {
            var obj = {};
            var typeName = $(this).find('h5').html();
            var tmp = {};
            $(this).find('ul>li').each(function () {
                var oA = $(this).find('a');

                var ct = {};
                ct.url = $(oA).attr('href');
                ct.name = $(oA).html().replace(/^<img.*>/, '');

                var self = $(this);
                var left = self.css('left').replace(/px/, '');
                var top = self.css('top').replace(/px/, '');

                //权重 = left + top * col_base
                var weight = parseInt(left) + parseInt(top) * 10000;
                tmp[weight] = ct;
            });

            var arr = [];
            for (var i in tmp) {
                var val = tmp[i];
                arr.push(val);
            }

            obj.type = typeName;
            obj.websiteList = arr;
            param.push(obj);
        });

        console.log(JSON.stringify(param));
        /*$.post("/save", {"param": JSON.stringify(param)},
            function (data) {
                console.log(data.result);
            }, "json");*/
    }

    function post() {
        var oSf = $("#sortForm")
        oSf.append('<input type="text" name="test" value="123" >');
        oSf.submit();
    }
</script>
</body>
</html>